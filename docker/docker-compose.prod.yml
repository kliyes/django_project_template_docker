version: '2'

services:

  web:
    command: bash -c "./manage.py collectstatic --noinput && ./manage.py migrate && uwsgi --ini uwsgi.ini"
    volumes:
      - ../src:/opt/src
      - /data/static:/opt/static
      - /data/media:/opt/media

  nginx:
    restart: always
    build: ./nginx
    hostname: nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /data/static:/opt/static
      - /data/media:/opt/media
    links:
      - web
